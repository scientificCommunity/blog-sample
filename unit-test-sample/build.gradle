plugins {
    id 'java'
    id 'jacoco'
}

group 'org.baichuan.example.unit-test'
version '1.0-SNAPSHOT'

repositories {
    mavenCentral()
}

dependencies {

}

//test {
task myTest(type: Test) {
    useTestNG()
    useJUnitPlatform()
    //includes = ['com/baichuan/example/unit_test/usage/**']
    excludes = ['org/baichuan/example/vertx/test/**']

    finalizedBy jacocoTestReport
//    testLogging {
//        events("passed", "skipped", "failed")
//    }
    reports {
        junitXml.required = false
        html.required = true
    }
    jacoco {
        enabled = true
        //用于ide
        destinationFile = layout.buildDirectory.file("jacoco/${name}.exec").get().asFile
        includes = []
        includes = []
        excludes = []
        excludeClassLoaders = []
        includeNoLocationClasses = false
        sessionId = "<auto-generated value>"
        dumpOnExit = true
        classDumpDir = null
        output = JacocoTaskExtension.Output.FILE
        address = "localhost"
        port = 6300
        jmx = false
    }
}

jacocoTestReport {
    // tests are required to run before generating the report
    dependsOn myTest
    afterEvaluate {
        classDirectories.setFrom(files(classDirectories.files.collect {
            fileTree(dir: it, include: 'com/baichuan/example/unit_test/**')
            //fileTree(dir: it, include: 'com/project5e/mampod_payment/controller/**')
        }))
    }
    reports {
        xml.required = false
        csv.required = false
        html.outputLocation = layout.buildDirectory.dir('jacocoHtml')
    }

}
